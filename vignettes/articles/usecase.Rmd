---
title: "use_case"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## USE CASE - METEO (1)

1. Pobieranie danych miesiecznych ze stacji meteo (SYNOP)
1. Zrobienie wykresu dla 1-2 wybranych stacji (np. Poznan i Warszawa - w miare homogeniczne, Wroclaw odpalony za bardzo)
1. Zrobienie wykresow dla miesiecy i wrzucenie trendu liniowego

```{r}
library(imgw)
library(ggplot2)
library(dplyr)
meteo_poz = meteo("monthly", rank = "synop", year = 1966:2018, station = "POZNAŃ") %>% 
  select(id, station, yy, mm, t2m_mean_mon) %>% 
  group_by(yy) %>%
  summarise(t2 = mean(t2m_mean_mon))

ggplot(meteo_poz, aes(yy, t2)) +
  geom_line() + 
  geom_smooth(method = "lm", se = FALSE) +
  labs(title = "Poznań", 
       subtitle = "Annual mean air temperature (1966 - 2018)",
       x = "Year",
       y = "Temperature [*C]") +
  ggpubr::stat_regline_equation()

# or as an alternative:
plot(
  meteo_poz$yy,
  meteo_poz$t2,
  type = 'l',
  xlab = 'Year',
  ylab = "Temperature [*C]",
  main = "Poznań - annual mean air temperature (1966 - 2018)"
  )
model = lm(t2 ~ yy, data = meteo_poz)
abline(model, col = "red", lwd = 3)
legend("topleft",
       legend = paste0("y = ", round(coef(model)[2], 3), "x  ",
                       round(coef(model)[1], 1)), bty = "n")
```

## USE CASE - METEO (2)

1. Przetworzenie pobranych danych na serie roczne
1. Zgridowanie do 0.01 poprzez interpolacje? (albo przerobienie na kilometrowke)
1. Obliczenie trendu dla serii rocznej w punktach gridowych - robisz mape dla wspolczynnika kierunkowego trendu w PL

```{r}
library(imgw)
library(ggplot2)
library(dplyr)
library(sf)
library(gstat)
meteo_mon = meteo("monthly", rank = "synop", year = 1966:2018, coords = TRUE) %>% 
  select(id, station, X, Y, yy, mm, t2m_mean_mon) %>% 
  group_by(yy, id, station, X, Y) %>%
  summarise(t2 = mean(t2m_mean_mon))
head(meteo_mon)
meteo_mon = meteo_mon %>% filter(!is.na(X))
meteo_mon_sp = st_as_sf(meteo_mon, coords = c("X", "Y"), crs = 4326) %>% 
  st_transform(2180)

library(tmap)
library(rnaturalearth)
library(rnaturalearthdata)
europe = ne_countries(scale = "medium", continent = "Europe", returnclass = "sf")

tm_shape(europe) + 
  tm_borders(col = "black", lwd = 2) +
  tm_shape(meteo_mon_sp) +
  tm_symbols(col = "t2", title.col = "") + 
  tm_facets(by = "yy")  + 
  tm_layout(main.title = "Annual mean air temperature in Poland")
```



## USE CASE - HYDRO (1)
Moze byc ten ktory jest w winietce z przeplywami

## USE CASE - SOUNDING
Wykres termodynamiczny z inwersja

